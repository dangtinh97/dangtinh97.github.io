<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Voice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>
<body>
<div class="container">
    <strong id="data"></strong>
    <textarea id="result" class="form-control" rows="50" readonly></textarea>
</div>
<script
    src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    window.SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
    function setup () {

      this.recognition = new SpeechRecognition()
      // this.recognition.lang = getLang(); // Thiết lập ngôn ngữ
      this.recognition.lang = 'vi-VN' // Thiết lập ngôn ngữ
      this.recognition.interimResults = false // Không hiển thị kết quả tạm thời
      this.recognition.maxAlternatives = 1 // Số lượng kết quả tối đa
      this.recognition.continuous = true
      this.recognition.onend = () => {
        $('#data').html('Stop recognition')
        setTimeout(()=>{
          $('#data').html('Restart recognition')
          this.recognition.start()
        },500)

      }
    }
    if(window.SpeechRecognition){
      $('#data').html('Start')
      setup()
    }else {
      $('#data').html("Start Error")
      setup()
    }


    function listen () {
      this.playAudio = false
      this.recognition.start()
    }

    function result () {
      this.recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript.trim().toLowerCase()
        $('#result').append(transcript+'\n')
        console.log('Transcript:', transcript)
      }
    }

    listen()
    result()
  })
</script>
</body>
</html>
