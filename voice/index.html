<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Voice</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        #log{
            overflow-y: auto;
            max-height: 300px;
            border: 1px #ff2626 solid;
            padding: 10px;
            border-radius: 8px;
        }
    </style>
</head>
<body>
<div class="container">
    <div id="user-agent"></div>
    <div id="log" class="border-1">
        <ul>
            <li id="error"></li>
            <li id="ended"></li>
        </ul>
    </div>
    <div class="form-group my-3">
        <button id="clear-log" class="btn btn-sm btn-danger">Clear Log</button>
        <button id="clear-result" class="btn btn-sm btn-danger">Clear Result</button>
        <button id="action" class="btn btn-sm btn-outline-danger">...</button>
        <div class="mt-2">
            <label class="d-block">
                <span>Auto restart: </span>
                <input type="checkbox" id="auto-restart">
            </label>
            <label class="d-block">
                <span>interimResults: </span>
                <input type="checkbox" id="interimResults">
            </label>
        </div>
    </div>
    <textarea id="result" class="form-control" rows="15" readonly></textarea>
    <textarea id="result2" class="form-control" rows="15" readonly></textarea>

    <button type="button" id="play-audio">Play Audio</button>
</div>
<script
    src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"></script>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    let final_transcript = '';
    if('webkitSpeechRecognition' in window){
      $('#action').html('REC')
      let recognition = new webkitSpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      recognition.lang = 'en-US';
      recognition.onresult = (event) => {
        var interim_transcript = '';
        if (typeof(event.results) == 'undefined') {
          recognition.onend = null;
          recognition.stop();
          upgrade();
          return;
        }
        for (var i = event.resultIndex; i < event.results.length; ++i) {
          if (event.results[i].isFinal) {
            final_transcript += event.results[i][0].transcript;
          } else {
            interim_transcript += event.results[i][0].transcript;
          }
        }
        final_transcript = capitalize(final_transcript);
        if(final_transcript){
          $('#result2').html(final_transcript)
        }
        $('#result').html(interim_transcript)
      }
      $('#action').on('click',()=>{
        recognition.start();
      })
      var first_char = /\S/;
      function capitalize(s) {
        return s.replace(first_char, function(m) { return m.toUpperCase(); });
      }

    }
  })
</script>
</body>
</html>
