<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Gửi thông báo</title>
  <link rel="stylesheet" href="./assets/app.css">
</head>
<body>
<div class="card">
  <h2>Gửi thông báo</h2>
  <div id="infoForm">
    <div class="form-group">
      <label for="passcode">Passcode</label>
      <input
              type="password"
              id="passcode"
              placeholder="Nhập passcode"
              required
              minlength="6"
              aria-describedby="passcode-error"
      >
      <span id="passcode-error" class="error-message">Passcode phải có ít nhất 6 ký tự</span>
    </div>

    <div class="form-group">
      <label for="title">Tiêu đề</label>
      <input
              type="text"
              id="title"
              placeholder="Nhập tiêu đề"
              required
              aria-describedby="title-error"
        value="YouPiP is ad-free."
      >
      <span id="title-error" class="error-message">Vui lòng nhập tiêu đề</span>
    </div>

    <div class="form-group">
      <label for="content">Nội dung</label>
      <textarea
              id="content"
              placeholder="Nhập nội dung..."
              required
              aria-describedby="content-error"
        
      >Smooth YouTube, no ads – only 1.59$!</textarea>
      <span id="content-error" class="error-message">Vui lòng nhập nội dung</span>
    </div>

    <button type="button" id="send">Xác nhận</button>
    <div id="success-message" class="success-message">
      Đã gửi thông tin thành công!
    </div>
  </div>
</div>
<script src="assets/common.js"></script>
<script src="assets/jquery-3.7.1.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
<script>
  document.addEventListener("DOMContentLoaded",()=>{
    const form = document.getElementById('infoForm');
    const successMessage = document.getElementById('success-message');
    $('#passcode').val(window.localStorage.getItem('passcode'))
    $('#send').on('click',()=>{
      const passcode = document.getElementById('passcode');
      let url = getUrl(passcode.value);
      if(!url){
        return alert('PASSCODE FAILED!')
      }
      window.localStorage.setItem('passcode',passcode.value)
      const title = document.getElementById('title');
      const content = document.getElementById('content');

      // Reset error messages
      document.querySelectorAll('.error-message').forEach(error => {
        error.style.display = 'none';
      });

      // Validate form
      let isValid = true;

      if (passcode.value.length < 6) {
        document.getElementById('passcode-error').style.display = 'block';
        passcode.focus();
        isValid = false;
      }

      if (!title.value.trim()) {
        document.getElementById('title-error').style.display = 'block';
        if (isValid) title.focus();
        isValid = false;
      }

      if (!content.value.trim()) {
        document.getElementById('content-error').style.display = 'block';
        if (isValid) content.focus();
        isValid = false;
      }
      if(!isValid){
        return alert("Vui lòng điền đủ thông tin.")
      }
      $.ajax({
        url:`${url}/notifications/send`,
        type:'POST',
        dataType:"JSON",
        data:{
          "message": {
            "topic": "daily",
            "notification": {
              "title": title.value,
              "body": content.value
            }
          }
        },
        success:(res)=>{
          if(res.status!==200){
            return alert(res.message)
          }
          successMessage.style.display = 'block';
          // Hide success message after 3 seconds
          setTimeout(() => {
            successMessage.style.display = 'none';
          }, 3000);
        }
      })
    })

    // Xử lý sự kiện input để ẩn thông báo lỗi khi người dùng bắt đầu nhập
    // ['passcode', 'title', 'content'].forEach(id => {
    //   document.getElementById(id).addEventListener('input', function() {
    //     document.getElementById(`${id}-error`).style.display = 'none';
    //   });
    // });
  })

</script>
</body>
</html>
