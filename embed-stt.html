<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TTS_EMBED</title>
</head>
<body style="height: 100vh;width: 100vw; padding: 10px">
<div>
    <p>Version 1.11</p>
    <p id="transcript"></p>
    <div id="logs"></div>
</div>
<script>
    document.addEventListener("DOMContentLoaded",()=>{
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      if(!SpeechRecognition){
        alert("not support")
      }
      const recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      let href = window.location.href;
      let textOld = '';
      const urlParams = new URLSearchParams(new URL(href).search);
      let lang = urlParams.get('lang');
      let vLogs = document.getElementById('logs');
      addLog("Click to body is starting record")
      addLog(lang)
      recognition.onresult = (event) => {
        let transcript = ''
        for (let i = event.resultIndex; i < event.results.length; i++) {
          transcript = event.results[i][0].transcript
        }
        transcript = transcript.trim();
        if(transcript===textOld){
          return;
        }
        textOld = transcript;
        document.getElementById('transcript').innerText = transcript;
      };
      recognition.onstart = ()=>{
        addLog("recognition started....");
      }
      recognition.onend = (e)=>{
        console.log(e)
        addLog(e.type)
        recognition.start();
      }
      recognition.onerror = (event)=>{
        addLog(event.error)
      }
      setTimeout(()=>{
        recognition.lang = lang;
        recognition.start();
      },100)
      document.body.addEventListener("click",() => {

        addLog("recognition starting....");
        return;
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(stream => {
            addLog("Microphone access granted!", stream);
          })
          .catch(error => {
            addLog("Microphone access denied!", error);
          });
      });
      function addLog(text){
        let timeNew = new Date();
        vLogs.innerText += `${timeNew.getHours()}:${timeNew.getMinutes()}:${timeNew.getSeconds()} - ${text}\n`
      }
    })
</script>
</body>
</html>
