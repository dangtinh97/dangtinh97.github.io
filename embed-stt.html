<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>TTS_EMBED</title>
</head>
<body style="height: 100vh;width: 100vw">
<div>
    <p>Version 1.5</p>
    <div id="logs"></div>
    <p id=""></p>
</div>
<script>
    document.addEventListener("DOMContentLoaded",()=>{
      const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
      const recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = true;
      let href = window.location.href;
      let textOld = '';
      const urlParams = new URLSearchParams(new URL(href).search);
      let lang = urlParams.get('lang');
      let vLogs = document.getElementById('logs');
      addLog("Click to body is starting record")
      addLog(new Date().toString())
      addLog(lang)
      recognition.lang = lang;
      recognition.onresult = (event) => {
        const transcript = event.results[0][0].transcript.trim();
        if(transcript!==textOld){
          textOld = transcript;
          addLog(transcript)
        }

      };
      recognition.onstart = ()=>{
        addLog("recognition started....");
      }
      recognition.onend = (e)=>{
        console.log(e)
        addLog(e.type)
      }
      recognition.onerror = (event)=>{
        addLog(event.error)
      }
      document.body.addEventListener("click",() => {
        recognition.start();
        addLog("recognition starting....");
        navigator.mediaDevices.getUserMedia({ audio: true })
          .then(stream => {
            addLog("Microphone access granted!", stream);
          })
          .catch(error => {
            addLog("Microphone access denied!", error);
          });
      });
      function addLog(text){
        let timeNew = new Date();
        vLogs.innerText += `${timeNew.getHours()}:${timeNew.getMinutes()}:${timeNew.getSeconds()} - ${text}\n`
      }
    })
</script>
</body>
</html>
